<!DOCTYPE html>
<html lang="en-us">

<head> 
    
    <meta charset="UTF-8" />
    <meta name="description" content="Website To host a timed test on Javascript and display the high scores" />
    <meta name="keywords" content="Test, Timed, High, Score, javascript, html, main page" />
    <meta name="author" content="Ikemous" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />

    <title>Weather</title>

    
    <!-- Link CSS Style Sheet -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" 
    crossorigin="anonymous" />

    <style>

        /* .container{
            margin-left: 50px;
            margin-right: 50px;
        } */

        ul{
            width: 90%;
        }

        .mainCard{
            width: 100%;
        }

        .input-group{
            width: 75%;
        }
        .forecast{
            font-size: 14px;
            /* padding: 20px; */
            margin: 10px;
        }
        
        .forecast h4{
            font-size: 16px;
        }

    </style>


</head>


<body>

    <!-- Weather Dashboard -->
    <header class="container-full">
        
        <section class="bg-dark row">

            <span class="col-sm-12">
                <h1 class="text-center">Navbar</h1>
            </span>
              
        </section>

    </header>

    <!-- container -->
    <main class="container">

        <!-- big row to hold all items -->
        <section class="row">

            <!-- col 4? Hold the search bar hold main city buttons-->
            <section class="col-sm-4">
                
                <!-- Row for search bar -->
                <article class="row">
                    <h5>Search For City:</h5>
                </article>  
                
                <!-- Row for search bar -->
                <article class="row">

                    <div class="input-group">
                        <!-- Search Input Box -->
                        <input type="text" class="form-control" placeholder="City Name" id="cityInput" />
                        
                        <div class="input-group-append">
                            <!-- Search Button -->
                            <button class="btn btn-success" type="button" id="addBtn">Add City</button>
                        </div>

                    </div>
                    
                </article>

                <!-- To hold all main city buttons -->
                <article class="row">

                    <ul class="list-group" id="citiesList">

                    </ul>
                      

                </article>


            </section>
                
            <!-- col 8? hold all weather information for a city -->
            <section class="col-sm-8">

                <article class="row">
                
                    <div class="card mainCard">
                        
                        <div class="card-body">

                        <h4 class="card-title text-center" id="cityHeader"> City </h4>
                        <p class="card-text" id="tempText"> Temp: </p>
                        <p class="card-text" id="humidityText"> Humidity: </p>
                        <p class="card-text" id="windSpeedText"> WindSpeed: </p>
                        <p class="card-text" id="indexText"> Index: </p>

                        </div>

                    </div>
                    
                
                </article>

                
                <h3>5 Day Forecast: </h3>

                <article class="row" id="forecastDiv">

                    

                </article>

                  

                <!-- card div for the the city weather informaion -->
                    <!-- city and date -->
                    <!-- Temp in F -->
                    <!-- Humdity -->
                    <!-- Windspeed -->
                    <!-- Humidity index -->
                    <!-- api.openweathermap.org/data/2.5/weather?id={city id}&appid={your api key} -->
                    <!--  -->
            </section>



        </section>
    </main>



    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/moment.min.js"></script>
    
    <script src="./Assets/js/myScript.js"></script>

    <script>

        let search = "Bujumbura";


        init();

        function init(){

            let queryURL = "https://api.openweathermap.org/data/2.5/weather?q=" + search + "&appid=16da2c71dd8c2c76dfce15f0f75a5dea";
            console.log(queryURL);
            
            $.ajax({
                url: queryURL,
                method: 'GET'
            }).then(function(weather){
                console.log(weather);

                // Set up the text for the main header
                let townName = weather.name;
                let townCountry = weather.sys.country;
                let timeStamp = new Date(weather.dt * 1000);
                timeStamp = moment(timeStamp).format("MM/DD/YYYY");
                let headerTitle = townName + ", " + townCountry + " " + "(" + timeStamp + ")";

                //Set up the Temp in F
                let temp = (weather.main.temp - 273.15) * 9/5 + 32;
                temp = temp.toFixed(2);            

                //Assign Text To Card IDs
                $("#cityHeader").text(headerTitle);
                $("#tempText").text("Temp:  "  + temp + "°F");
                $("#humidityText").text("Humidity: " + weather.main.humidity);
                $("#windSpeedText").text("WindSpeed: " + weather.wind.speed);

                //define coordinates
                let lon = weather.coord.lon;
                let lat = weather.coord.lat;
                
                let forecastURL = "https://api.openweathermap.org/data/2.5/onecall?appid=16da2c71dd8c2c76dfce15f0f75a5dea&lat=" + lat + "&lon=" + lon;

                $.ajax({
                    url: forecastURL,
                    method: 'GET'
                }).then(function(forecast){

                    $("#forecastDiv").empty();

                    console.log(forecast);

                    let weatherDays = forecast.daily;
                    console.log(weatherDays);

                    for(let i = 1; i <  6; i++)
                    {
                        let theDate = new Date(weatherDays[i].dt * 1000);
                        theDate = moment(theDate).format("MM/DD/YYYY");
                        console.log(theDate);
                        
                        //create card div
                        let $newCard = $("<div>");
                        $newCard.addClass("card  col-sm-2 forecast");
                        $("#forecastDiv").append($newCard);
                        
                        let $newCardBody = $("<div>");
                        $newCardBody.addClass("card-body");
                        $newCard.append($newCardBody);

                        let $cardheader = $("<h4>");
                        $cardheader.text(theDate);
                        $cardheader.addClass("row");
                        $newCardBody.append($cardheader);

                        
                        let dayIcon = "http://openweathermap.org/img/wn/" + weatherDays[i].weather[0].icon + ".png";

                        let $icon = $("<img>");
                        $icon.addClass("row");
                        $icon.attr("src",dayIcon);
                        $newCardBody.append($icon);

                        let dayTemp = (weatherDays[i].temp.day- 273.15) * 9/5 + 32;
                        dayTemp = dayTemp.toFixed(2);

                        
                        let $tempParagraph = $("<p>");
                        $tempParagraph.addClass("row");
                        $tempParagraph.text("Temp: " + dayTemp + "°F");
                        $newCardBody.append($tempParagraph);

                        let $humidityParagraph = $("<p>");
                        $humidityParagraph.addClass("row");
                        $humidityParagraph.text("Humidity: " + weatherDays[i].humidity);
                        $newCardBody.append($humidityParagraph);
                        

                    }

                    
                    $("#indexText").text("UV Index: " + forecast.current.uvi);
                    let uvNum = Math.floor(forecast.current.uvi);

                    //UV index	Media graphic color	Risk of harm from unprotected Sun exposure, for the average adult
                        // 0 to 2	Green	"Low"
                        // 3 to 5	Yellow	"Moderate"
                        // 6 to 7	Orange	"High"
                        // 8 to 10	Red	"Very high"
                    console.log(uvNum);
                    switch(uvNum)
                    {
                        case 0,1,2:
                            console.log("1");
                            break;
                        case 3,4,5:
                            console.log("2");
                            break;
                        case 6,7:
                            console.log("3");
                            break;
                        case 8:
                            console.log("4");
                            break;
                        default:
                            break;
                    }

                })

            });

        }
        
        $("#citiesList").on("click", "li", function(){
            console.log(search);
            init();
        });

        $("#addBtn").click(function(){
            let $listItem = $("<li>");
            $listItem.text($("#cityInput").val());
            $listItem.addClass("list-group-item");
            $listItem.attr("data-search", $("#cityInput").val())
            $("#citiesList").append($listItem);
        });

    </script>

</body>

</html>