<!DOCTYPE html>
<html lang="en-us">

<head> 
    
    <meta charset="UTF-8" />
    <meta name="description" content="Website To host a timed test on Javascript and display the high scores" />
    <meta name="keywords" content="Test, Timed, High, Score, javascript, html, main page" />
    <meta name="author" content="Ikemous" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />

    <title>Weather</title>

    
    <!-- Link CSS Style Sheet -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" 
    crossorigin="anonymous" />
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css" integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf" crossorigin="anonymous" />

    <style>

        .listCol{
            padding-left: 25px;
            padding-bottom: 10px
        }
        ul{
            width: 90%;
        }
        header{
            padding-bottom: 20px;
        }
        .bg-dark{
            color: white;
        }
        .mainCard{
            width: 100%;
        }
        .input-group{
            width: 90%;
        }
        .card-body img{
            height: 100px;
        }
        .forecast{
            margin-top: 5px;
            margin: 5px;
        }
        .forecast .card{
            font-size: 14px;
            margin: 10px;
            line-height: 10px;
        }
        .forecast .card-body{
            padding: 0px;
        }
        .forecast .card-body img{
            height: 50px;
            margin-left: auto;
            margin-right: auto;
        }
        .forecast .card-body p{
            margin-bottom: 10px;
        }
        .forecast .card-body h4{
            font-size: 20px;
            margin-top: 2px;
            font-weight: bolder;
        }
        .weatherRow{
            padding-left: 40px;
            padding-right: 40px;
        }
        /*
            // 0 to 2	Green	"Low"
            // 3 to 5	Yellow	"Moderate"
            // 6 to 7	Orange	"High"
            // 8 to 10	Red	"Very high"

        */
        .uvLow{
            background-color: green;
        }
        .uvModerate{
            background-color: yellow;

        }
        .uvHigh{
            background-color: orange;
        }
        .uvVeryHigh{
            background-color: red;
        }

    </style>


</head>


<body>

    <!-- Weather Dashboard -->
    <header class="container-full">
        
        <section class="bg-dark row">

            <span class="col-sm-12">
                <h1 class="text-center">Weather Dashboard</h1>
            </span>
              
        </section>

    </header>

    <!-- container -->
    <main class="container-full weather">

        <!-- big row to hold all items -->
        <section class="row">

            <!-- col 4? Hold the search bar hold main city buttons-->
            <section class="col-sm-3">
                
                <!-- Row for search bar -->
                <article class="row listCol">
                    <h5>Search For City:</h5>
                </article>  
                
                <!-- Row for search bar -->
                <article class="row listCol">

                    <div class="input-group">
                        <!-- Search Input Box -->
                        <input type="text" class="form-control" placeholder="City Name" id="cityInput" />
                        
                        <div class="input-group-append">
                            <!-- Search Button -->
                            <button class="btn btn-success" type="button" id="addBtn"><i class="fas fa-search"></i></button>
                        </div>

                    </div>
                    
                </article>

                <!-- To hold all main city buttons -->
                <article class="row listCol">

                    <ul class="list-group" id="citiesList">
                        <li class="list-group-item" data-search="Bujumbura">Bujumbura</li>
                        <li class="list-group-item" data-search="London">London</li>
                    </ul>
                      

                </article>


            </section>
                
            <!-- col 8? hold all weather information for a city -->
            <section class="col-sm-9 weatherRow">

                <section class="row ">
                    
                        <div class="card mainCard">
                            
                            <div class="card-body">

                                <h4 class="card-title text-center" id="cityHeader"> City </h4>
                                
                                <p class="card-text" id="tempText"> Temp: </p>
                                <p class="card-text" id="humidityText"> Humidity: </p>
                                <p class="card-text" id="windSpeedText"> WindSpeed: </p>
                                <p class="card-text" id="indexText"> Index: </p>
                        
                                
                                
                            </div>

                        </div>
                    
                
                </section>

                
                <h3>5 Day Forecast: </h3>

                <article class="row" id="forecastDiv">

                </article>

            </section>

        </section>

    </main>



    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/moment.min.js"></script>
    
    <script src="./Assets/js/myScript.js"></script>

    <script>

        let search = "Bujumbura";


        init();

        
        function init(){

            let queryURL = "https://api.openweathermap.org/data/2.5/weather?q=" + search + "&appid=16da2c71dd8c2c76dfce15f0f75a5dea";
            
            $.ajax({
                url: queryURL,
                method: 'GET'
            }).then(function(weather){
                console.log(weather);

                // Set up the text for the main header
                let townName = weather.name;
                let townCountry = weather.sys.country;
                let timeStamp = new Date(weather.dt * 1000);
                timeStamp = moment(timeStamp).format("MM/DD/YYYY");
                let headerTitle = townName + ", " + townCountry + " " + "(" + timeStamp + ")";

                //Set up the Temp in F
                let temp = (weather.main.temp - 273.15) * 9/5 + 32;
                temp = temp.toFixed(2);            

                let currentDayIcon = weather.weather[0].icon;
                


                //Assign Text To Card IDs
                $("#cityHeader").text(headerTitle);
                $("#tempText").text("Temp:  "  + temp + "°F");
                $("#humidityText").text("Humidity: " + weather.main.humidity);
                $("#windSpeedText").text("WindSpeed: " + weather.wind.speed);
                $("#todaysIcon").attr("src", "http://openweathermap.org/img/wn/" +  currentDayIcon + ".png");

                //define coordinates
                let lon = weather.coord.lon;
                let lat = weather.coord.lat;
                
                let forecastURL = "https://api.openweathermap.org/data/2.5/onecall?appid=16da2c71dd8c2c76dfce15f0f75a5dea&lat=" + lat + "&lon=" + lon;

                $.ajax({
                    url: forecastURL,
                    method: 'GET'
                }).then(function(forecast){

                    $("#forecastDiv").empty();

                    let weatherDays = forecast.daily;

                    for(let i = 1; i <  6; i++)
                    {
                        let theDate = new Date(weatherDays[i].dt * 1000);
                        theDate = moment(theDate).format("MM/DD/YYYY");
                        
                        //create card div
                        let $newCard = $("<div>");
                        $newCard.addClass("card col-sm forecast");
                        $("#forecastDiv").append($newCard);
                        
                        let $newCardBody = $("<div>");
                        $newCardBody.addClass("card-body");
                        $newCard.append($newCardBody);

                        let $cardheader = $("<h4>");
                        $cardheader.text(theDate);
                        $cardheader.addClass("lead");
                        $newCardBody.append($cardheader);

                        
                        let dayIcon = "http://openweathermap.org/img/wn/" + weatherDays[i].weather[0].icon + ".png";

                        let $icon = $("<img>");
                        $icon.addClass("row");
                        $icon.attr("src",dayIcon);
                        $newCardBody.append($icon);

                        let dayTemp = (weatherDays[i].temp.day- 273.15) * 9/5 + 32;
                        dayTemp = dayTemp.toFixed(2);
                        
                        let $tempParagraph = $("<p>");
                        $tempParagraph.addClass("card-text");
                        $tempParagraph.text("Temp: " + dayTemp + "°F");
                        $newCardBody.append($tempParagraph);

                        let $humidityParagraph = $("<p>");
                        $humidityParagraph.addClass("card-text");
                        $humidityParagraph.text("Humidity: " + weatherDays[i].humidity);
                        $newCardBody.append($humidityParagraph);
                        
                    }

                    
                    $("#indexText").text("UV Index: " + forecast.current.uvi);
                    let uvNum = Math.floor(forecast.current.uvi);

                    //UV index	Media graphic color	Risk of harm from unprotected Sun exposure, for the average adult
                        // 0 to 2	Green	"Low"
                        // 3 to 5	Yellow	"Moderate"
                        // 6 to 7	Orange	"High"
                        // 8 to 10	Red	"Very high"
                    console.log(uvNum);
                    if(uvNum >= 0 && uvNum <= 2)
                    {
                        $("#indexText").attr("class", "uvLow");
                    }
                    else if(uvNum >= 3 && uvNum <= 5)
                    {
                        $("#indexText").attr("class", "uvModerate");                        
                    }
                    else if(uvNum >= 6 && uvNum <= 7)
                    {
                        $("#indexText").attr("class", "uvHigh");
                    }
                    else
                    {
                        $("#indexText").attr("class", "uvVeryHigh");
                    }

                })

            });

        }
        
        $("#citiesList").on("click", "li", function(){
            search = $(this).data("search");
            console.log(search);
            init();
        });


        $("#addBtn").click(function(){
            let $listItem = $("<li>");
            let listText = $("#cityInput").val();
            listText = listText.trim();
            $listItem.text(listText);
            $listItem.addClass("list-group-item");
            $listItem.attr("data-search", $("#cityInput").val())
            $("#citiesList").append($listItem);
        });

    </script>

</body>

</html>